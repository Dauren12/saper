<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Сапёр PRO</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
  --cell-size: 34px;
  --bg-primary: #1c1c1c;
  --bg-secondary: #2d2d2d;
  --text-primary: #ffffff;
  --cell-closed: #444;
  --cell-open: #aaa;
  --border: #666;
  --mine: #d32f2f;
  --flag: #ff9800;
  --num-1: #1976d2;
  --num-2: #388e3c;
  --num-3: #d32f2f;
  --num-4: #7b1fa2;
  --shadow: rgba(0,0,0,0.5);
}

.light-theme {
  --bg-primary: #f5f5f5;
  --bg-secondary: #ffffff;
  --text-primary: #333;
  --cell-closed: #bdbdbd;
  --cell-open: #e0e0e0;
  --border: #9e9e9e;
  --mine: #d32f2f;
  --flag: #ff9800;
  --num-1: #1976d2;
  --num-2: #388e3c;
  --num-3: #d32f2f;
  --num-4: #7b1fa2;
  --shadow: rgba(0,0,0,0.1);
}

* { box-sizing: border-box; transition: background-color 0.3s, color 0.3s; }
body {
  margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: var(--bg-primary); color: var(--text-primary);
  min-height: 100vh; display: flex; flex-direction: column; align-items: center; padding: 20px;
}
header { text-align: center; margin-bottom: 20px; max-width:800px; }
h1 { margin:10px 0; font-size:2.5rem; color:var(--text-primary); text-shadow:2px 2px 4px var(--shadow); }
.subtitle { margin:5px 0 20px; opacity:0.8; }
.controls { display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin:20px 0; padding:15px; background:var(--bg-secondary); border-radius:10px; box-shadow:0 4px 6px var(--shadow); width:100%; max-width:800px; }
.control-group { display:flex; align-items:center; gap:10px; }
select, button { padding:10px 15px; border:none; border-radius:6px; font-size:16px; cursor:pointer; background:var(--cell-closed); color:var(--text-primary); font-weight:500; }
select { min-width:140px; }
button { display:flex; align-items:center; gap:8px; transition: transform 0.2s, opacity 0.2s; }
button:hover { opacity:0.9; transform: translateY(-2px); }
button:active { transform: translateY(0); }
.primary-btn { background:#4CAF50; color:white; }
.secondary-btn { background:#2196F3; color:white; }
.stats-container { display:flex; justify-content:space-around; flex-wrap:wrap; gap:20px; margin:20px 0; width:100%; max-width:800px; }
.stat-box { background:var(--bg-secondary); padding:15px 25px; border-radius:10px; min-width:140px; box-shadow:0 4px 6px var(--shadow); text-align:center; }
.stat-value { font-size:2rem; font-weight:bold; margin:5px 0; }
.stat-label { font-size:0.9rem; opacity:0.8; }
.board-container { margin:20px 0; padding:20px; background:var(--bg-secondary); border-radius:15px; box-shadow:0 6px 12px var(--shadow); overflow:auto; max-width:100%; }
.board { display:grid; gap:1px; background:var(--border); border:3px solid var(--border); border-radius:5px; margin:0 auto; }
.cell { width:var(--cell-size); height:var(--cell-size); background:var(--cell-closed); display:flex; align-items:center; justify-content:center; font-size:18px; font-weight:bold; cursor:pointer; user-select:none; position:relative; transition: background-color 0.2s; }
.cell:hover:not(.open):not(.flagged) { background:#555; filter:brightness(1.1); }
.cell.open { background:var(--cell-open); cursor:default; }
.cell.mine { background:var(--mine); color:white; }
.cell.flagged { background:var(--flag); color:white; }
.cell.question { background:#777; color:white; }
.cell.num-1 { color:var(--num-1); }
.cell.num-2 { color:var(--num-2); }
.cell.num-3 { color:var(--num-3); }
.cell.num-4 { color:var(--num-4); }
.cell.num-5 { color:#7b1fa2; }
.cell.num-6 { color:#00796b; }
.cell.num-7 { color:#5d4037; }
.cell.num-8 { color:#455a64; }
.highlight { animation: highlight 0.5s; }
@keyframes highlight { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
.modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:1000; justify-content:center; align-items:center; }
.modal-content { background:var(--bg-secondary); padding:30px; border-radius:15px; max-width:500px; width:90%; max-height:80vh; overflow-y:auto; box-shadow:0 10px 25px rgba(0,0,0,0.5); }
.modal h2 { margin-top:0; color:var(--text-primary); }
.close-btn { float:right; font-size:28px; cursor:pointer; }
.tutorial-step { margin:20px 0; padding:15px; background:var(--bg-primary); border-radius:8px; }
.tutorial-step i { margin-right:10px; color:#2196F3; }
#themeToggle { position:fixed; top:20px; right:20px; z-index:100; }
#recordsTable { width:100%; border-collapse:collapse; margin-top:15px; }
#recordsTable th, #recordsTable td { padding:10px; text-align:left; border-bottom:1px solid var(--border); }
.game-message { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); padding:20px 40px; border-radius:10px; font-size:24px; font-weight:bold; z-index:999; display:none; }
.win-message { background:#4CAF50; color:white; }
.lose-message { background:#d32f2f; color:white; }
@media (max-width:768px) { :root { --cell-size:28px; } h1 { font-size:2rem; } .controls { flex-direction:column; align-items:center; } .control-group { width:100%; justify-content:center; } select, button { width:100%; max-width:300px; } .stat-box { min-width:120px; padding:12px; } #themeToggle { position:static; margin-bottom:10px; } }
@media (max-width:480px) { :root { --cell-size:24px; } h1 { font-size:1.7rem; } .cell { font-size:16px; } }
</style>
</head>
<body>

<header>
  <h1><i class="fas fa-bomb"></i> Сапёр PRO</h1>
  <p class="subtitle">Классическая игра с улучшенным геймплеем</p>
</header>

<div class="controls">
  <div class="control-group">
    <select id="level">
      <option value="easy">Лёгкий (8×8, 10 мин)</option>
      <option value="medium">Средний (12×12, 25 мин)</option>
      <option value="hard">Сложный (16×16, 40 мин)</option>
      <option value="expert">Эксперт (20×20, 80 мин)</option>
    </select>
    <button class="primary-btn" onclick="startGame()"><i class="fas fa-play"></i> Новая игра</button>
    <button onclick="togglePause()" id="pauseBtn"><i class="fas fa-pause"></i> Пауза</button>
    <button class="secondary-btn" onclick="showTutorial()"><i class="fas fa-graduation-cap"></i> Обучение</button>
    <button onclick="showRecords()"><i class="fas fa-trophy"></i> Рекорды</button>
  </div>
</div>

<div class="stats-container">
  <div class="stat-box">
    <div class="stat-label"><i class="far fa-clock"></i> Время</div>
    <div class="stat-value" id="time">0</div>
  </div>
  <div class="stat-box">
    <div class="stat-label"><i class="fas fa-bomb"></i> Мины</div>
    <div class="stat-value" id="minesLeft">0</div>
  </div>
  <div class="stat-box">
    <div class="stat-label"><i class="fas fa-flag"></i> Флаги</div>
    <div class="stat-value" id="flags">0</div>
  </div>
  <div class="stat-box">
    <div class="stat-label"><i class="fas fa-expand-arrows-alt"></i> Размер</div>
    <div class="stat-value" id="boardSize">0×0</div>
  </div>
</div>

<div class="board-container">
  <div id="board" class="board"></div>
</div>

<button id="themeToggle" onclick="toggleTheme()"><i class="fas fa-moon"></i> Тема</button>

<!-- Модальные окна -->
<div id="tutorialModal" class="modal">
  <div class="modal-content">
    <span class="close-btn" onclick="closeModal('tutorialModal')">&times;</span>
    <h2><i class="fas fa-graduation-cap"></i> Обучение игре "Сапёр"</h2>
    <div class="tutorial-step"><h3><i class="fas fa-mouse-pointer"></i> Основные правила</h3>
      <p>Цель игры — открыть все клетки, не содержащие мин.</p>
      <p>Цифра на клетке показывает, сколько мин находится в соседних 8 клетках.</p>
    </div>
    <div class="tutorial-step"><h3><i class="fas fa-hand-point-up"></i> Управление</h3>
      <p><strong>Левый клик</strong> — открыть клетку</p>
      <p><strong>Правый клик</strong> — поставить/убрать флажок</p>
      <p><strong>Двойной клик</strong> по открытой клетке — открыть соседние клетки</p>
    </div>
    <div class="tutorial-step"><h3><i class="fas fa-lightbulb"></i> Советы</h3>
      <p>1. Начинайте с углов — там обычно меньше мин.</p>
      <p>2. Если цифра равна количеству флагов вокруг, можно открыть оставшиеся клетки двойным кликом.</p>
      <p>3. Используйте флаги для пометки предполагаемых мин.</p>
    </div>
    <button class="primary-btn" onclick="startGame(); closeModal('tutorialModal');" style="width:100%;"><i class="fas fa-play"></i> Начать игру</button>
  </div>
</div>

<div id="recordsModal" class="modal">
  <div class="modal-content">
    <span class="close-btn" onclick="closeModal('recordsModal')">&times;</span>
    <h2><i class="fas fa-trophy"></i> Рекорды</h2>
    <table id="recordsTable">
      <thead><tr><th>Уровень</th><th>Время</th><th>Дата</th></tr></thead>
      <tbody id="recordsBody"></tbody>
    </table>
    <button onclick="clearRecords()" style="margin-top:15px;"><i class="fas fa-trash"></i> Очистить рекорды</button>
  </div>
</div>

<div id="winMessage" class="game-message win-message"><i class="fas fa-trophy"></i> ПОБЕДА!</div>
<div id="loseMessage" class="game-message lose-message"><i class="fas fa-skull-crossbones"></i> ПОРАЖЕНИЕ</div>

<script>
// === Настройки уровней ===
const LEVELS = {
  easy: { rows: 8, cols: 8, mines: 10 },
  medium: { rows: 12, cols: 12, mines: 25 },
  hard: { rows: 16, cols: 16, mines: 40 },
  expert: { rows: 20, cols: 20, mines: 80 }
};

// === Состояние игры ===
const gameState = {
  board: [], rows:0, cols:0, mines:0, flags:0, opened:0,
  firstClick:true, gameOver:false, paused:false,
  timer:0, timerInterval:null, theme:'dark'
};

// === Инициализация ===
document.addEventListener('DOMContentLoaded', init);
function init() { loadTheme(); loadRecords(); startGame(); }

// === Тема ===
function loadTheme() {
  const saved = localStorage.getItem('minesweeperTheme');
  if(saved) { gameState.theme=saved; document.body.classList.toggle('light-theme', saved==='light'); updateThemeButton(); }
}
function toggleTheme() {
  gameState.theme = gameState.theme==='dark'?'light':'dark';
  document.body.classList.toggle('light-theme', gameState.theme==='light');
  localStorage.setItem('minesweeperTheme', gameState.theme);
  updateThemeButton();
}
function updateThemeButton() {
  const btn = document.getElementById('themeToggle');
  btn.innerHTML = '';
  const icon = document.createElement('i');
  icon.className = gameState.theme==='dark'?'fas fa-sun':'fas fa-moon';
  const text = document.createTextNode(gameState.theme==='dark'?' Светлая':' Тёмная');
  btn.appendChild(icon); btn.appendChild(text);
}

// === Старт игры ===
function startGame() {
  const level = document.getElementById('level').value;
  const config = LEVELS[level];
  gameState.rows=config.rows; gameState.cols=config.cols; gameState.mines=config.mines;
  gameState.flags=0; gameState.opened=0; gameState.firstClick=true; gameState.gameOver=false; gameState.paused=false;
  gameState.timer=0; clearInterval(gameState.timerInterval); gameState.timerInterval = setInterval(updateTimer,1000);
  updateStats(); createBoard(); document.getElementById('pauseBtn').innerHTML='<i class="fas fa-pause"></i> Пауза';
  hideMessages();
}

// === Создание поля ===
function createBoard() {
  const boardEl = document.getElementById('board'); boardEl.innerHTML='';
  boardEl.style.gridTemplateColumns=`repeat(${gameState.cols}, var(--cell-size))`;
  gameState.board=[];
  for(let i=0;i<gameState.rows*gameState.cols;i++){
    const cellEl=document.createElement('div'); cellEl.className='cell'; cellEl.dataset.index=i;
    cellEl.addEventListener('click',()=>handleClick(i));
    cellEl.addEventListener('contextmenu',(e)=>{ e.preventDefault(); handleRightClick(i); });
    cellEl.addEventListener('dblclick',()=>handleDoubleClick(i));
    boardEl.appendChild(cellEl);
    gameState.board.push({element:cellEl,isMine:false,isOpen:false,isFlagged:false,isQuestion:false,neighborMines:0});
  }
  document.getElementById('boardSize').textContent=`${gameState.cols}×${gameState.rows}`;
}

// === Клики ===
function handleClick(index){
  if(gameState.gameOver||gameState.paused) return;
  const cell=gameState.board[index];
  if(cell.isOpen||cell.isFlagged) return;
  if(gameState.firstClick){
    placeMines(index); gameState.firstClick=false; openCell(index); return;
  }
  if(cell.isMine){ gameOver(false); return; }
  openCell(index); checkWin();
}
function handleRightClick(index){
  if(gameState.gameOver||gameState.paused||gameState.firstClick) return;
  const cell=gameState.board[index];
  if(cell.isOpen) return;
  if(!cell.isFlagged&&!cell.isQuestion){
    cell.isFlagged=true; cell.isQuestion=false; cell.element.className='cell flagged'; cell.element.innerHTML='<i class="fas fa-flag"></i>'; gameState.flags++;
  } else if(cell.isFlagged){
    cell.isFlagged=false; cell.isQuestion=true; cell.element.className='cell question'; cell.element.textContent='?'; gameState.flags--;
  } else {
    cell.isQuestion=false; cell.element.className='cell'; cell.element.textContent='';
  }
  updateStats();
}
function handleDoubleClick(index){
  const cell=gameState.board[index];
  if(!cell.isOpen||cell.neighborMines===0) return;
  const neighbors=getNeighbors(index);
  neighbors.forEach(i=>{
    const neighbor=gameState.board[i];
    if(!neighbor.isOpen&&!neighbor.isFlagged) setTimeout(()=>handleClick(i),50);
  });
}

// === Открытие клеток ===
function openCell(index){
  const cell=gameState.board[index];
  if(cell.isOpen||cell.isFlagged) return;
  cell.isOpen=true;
  cell.element.classList.add('open');
  if(cell.isMine){ cell.element.classList.add('mine'); cell.element.innerHTML='<i class="fas fa-bomb"></i>'; return; }
  const mines=countNeighborMines(index); cell.neighborMines=mines;
  if(mines>0){ cell.element.textContent=mines; cell.element.classList.add(`num-${mines}`); } else { getNeighbors(index).forEach(i=>openCell(i)); }
  gameState.opened++; updateStats();
}

// === Счётчик соседей ===
function getNeighbors(index){
  const neighbors=[];
  const row=Math.floor(index/gameState.cols); const col=index%gameState.cols;
  for(let r=row-1;r<=row+1;r++){
    for(let c=col-1;c<=col+1;c++){
      if(r>=0&&r<gameState.rows&&c>=0&&c<gameState.cols&&(r!==row||c!==col)) neighbors.push(r*gameState.cols+c);
    }
  }
  return neighbors;
}
function countNeighborMines(index){ return getNeighbors(index).filter(i=>gameState.board[i].isMine).length; }

// === Расстановка мин ===
function placeMines(firstIndex){
  let placed=0;
  while(placed<gameState.mines){
    const i=Math.floor(Math.random()*gameState.board.length);
    if(i===firstIndex||gameState.board[i].isMine) continue;
    gameState.board[i].isMine=true; placed++;
  }
}

// === Таймер ===
function updateTimer(){ if(!gameState.paused&&!gameState.gameOver){ gameState.timer++; document.getElementById('time').textContent=gameState.timer; } }
function togglePause(){
  gameState.paused=!gameState.paused;
  const btn=document.getElementById('pauseBtn');
  if(gameState.paused){ btn.innerHTML='<i class="fas fa-play"></i> Продолжить'; } 
  else{ btn.innerHTML='<i class="fas fa-pause"></i> Пауза'; }
}

// === Статистика ===
function updateStats(){
  document.getElementById('flags').textContent=gameState.flags;
  document.getElementById('minesLeft').textContent=gameState.mines-gameState.flags;
  document.getElementById('time').textContent=gameState.timer;
}

// === Конец игры ===
function gameOver(win){
  gameState.gameOver=true;
  clearInterval(gameState.timerInterval);
  if(win){ showMessage(true); saveRecord(); } else{ revealMines(); showMessage(false); }
}
function revealMines(){
  gameState.board.forEach(cell=>{ if(cell.isMine) cell.element.innerHTML='<i class="fas fa-bomb"></i>'; });
}
function showMessage(win){
  document.getElementById(win?'winMessage':'loseMessage').style.display='block';
}
function hideMessages(){
  document.getElementById('winMessage').style.display='none';
  document.getElementById('loseMessage').style.display='none';
}

// === Проверка победы ===
function checkWin(){
  if(gameState.opened+gameState.mines===gameState.rows*gameState.cols) gameOver(true);
}

// === Рекорды ===
function loadRecords(){ if(!localStorage.getItem('minesweeperRecords')) localStorage.setItem('minesweeperRecords',JSON.stringify({})); }
function saveRecord(){
  const level=document.getElementById('level').value;
  const records=JSON.parse(localStorage.getItem('minesweeperRecords'));
  if(!records[level]||gameState.timer<records[level].time){ records[level]={time:gameState.timer,date:new Date().toLocaleDateString()}; localStorage.setItem('minesweeperRecords',JSON.stringify(records)); }
}
function showRecords(){
  const records=JSON.parse(localStorage.getItem('minesweeperRecords'));
  const tbody=document.getElementById('recordsBody'); tbody.innerHTML='';
  Object.keys(LEVELS).forEach(level=>{
    const tr=document.createElement('tr');
    const rec=records[level]; tr.innerHTML=`<td>${level}</td><td>${rec?rec.time:'—'}</td><td>${rec?rec.date:'—'}</td>`; tbody.appendChild(tr);
  });
  document.getElementById('recordsModal').style.display='flex';
}
function clearRecords(){ localStorage.setItem('minesweeperRecords',JSON.stringify({})); showRecords(); }

// === Модальные окна ===
function showTutorial(){ document.getElementById('tutorialModal').style.display='flex'; }
function closeModal(id){ document.getElementById(id).style.display='none'; }
</script>

</body>
</html>
